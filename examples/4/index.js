import{Grid as F}from"../chunk-R2BKI37H.js";import{THROTTLE_REJECT as G,createMemoSignal as C,default_equality as R,dom_clearTimeout as S,dom_setTimeout as b,falsey_equality as P,math_random as X,newArray2D as Y,noop as $,promiseTimeout as j,shuffleArray as D,signalCtx as f,throttle as H}from"../chunk-RLUFV3VX.js";var c={loading:3e3,throttle:200,trail:500,image_dir:"../assets/grid_images/"},T=(l,e,t,r=$)=>{let o=t===!1?P:t??R,n=H(e,o),s;return(m,g)=>{S(s);let a=n(m,g);return a===G?(s=b(r,l),!0):a}},y=8,x=10,i=new F({rows:y,cols:x,originAlign:"right",colAlign:["end"],rowAlign:["center"],colGap:[30],rowGap:[30]}),q=[.1,.1,.25,1.5/4,.25,1.5/4,1.75/4,1.25/4],_,J=async(l,e)=>{let t=new Image;_[l][e]=t,t.onload=()=>{L(l,e)},t.src=c.image_dir+`${l},${e}.jpg`},I=async(l=0)=>{_=Y(y,x);let e=[],t=[];for(let r=0;r<x;r++)for(let o=0;o<y;o++)e.push([o,r]);D(e);for(let[r,o]of e)t.push(j(X()*l).then(()=>J(r,o)));Promise.all(t)},L=(l,e)=>{let{width:t,height:r}=_[l][e];i.setCell(l,e,{width:t*q[l],height:r*q[l]})},u=document.createElement("canvas"),d=u.getContext("2d");u.width=2e3,u.height=800;var[M,O]=C(l=>i.getCellFrames(l),{equals:T(c.trail,c.throttle,!1,()=>f.runId(v))}),z=(l,e)=>{f.dynamic.setEquals(M,T(l,e,!1,()=>f.runId(v)))},B=()=>{let l=i.getCellFrames();d.reset(),console.log("redraw");for(let e=0;e<i.cols;e++)for(let t=0;t<i.rows;t++){let{left:r,top:o,x:n,y:s,width:m,height:g}=l[t][e],a=_[t][e];a&&d.drawImage(a,r+n,o+s,m,g)}},[v,K]=C(l=>{let e=O(l);d.reset(),console.log("throttled-redraw");for(let t=0;t<i.cols;t++)for(let r=0;r<i.rows;r++){let{left:o,top:n,x:s,y:m,width:g,height:a}=e[r][t],h=_[r][t];h&&d.drawImage(h,o+s,n+m,g,a)}},{equals:!1});u.onmousedown=l=>{let{offsetX:e,offsetY:t,currentTarget:r}=l,o=i.hit(e,t);if(o){let{left:n,top:s,x:m,y:g,width:a,height:h}=i.getCellFrame(...o),w=n+m,p=s+g,A=e>=w&&e<=w+a,k=t>=p&&t<=p+h;if(A&&k){let E=d.strokeStyle;d.strokeStyle="red",d.strokeRect(w,p,a,h),d.strokeStyle=E}}},document.body.appendChild(u),I(c.loading).then(()=>{K()});export{c as app_config,i as grid,I as loadAllImages,B as redraw,f as signalCtx,z as updateThrottleGetCellFrames_equals};
