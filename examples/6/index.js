import{Grid as G}from"../chunk-R2BKI37H.js";import{createLazy as b,dom_clearInterval as z,dom_setInterval as P,math_random as S,newArray2D as w,promiseTimeout as F,shuffleArray as T,signalCtx as X}from"../chunk-RLUFV3VX.js";var o={loading:1e3,lazy_load_interval:300,image_dir:"../assets/grid_images/",max_cols:7,col_offset:0,max_images:100},Y=class extends G{pushCol(t=1){this.pauseReactivity();let l=o.max_cols,e=o.col_offset,i=e+this.cols,s=Math.min(o.max_images,i+t),r=Math.max(0,e,s-l),a=r-e;a>0&&(super.shiftCols(a),o.col_offset=r);let _=w(Math.min(l,t),d,()=>({}));super.pushCols(..._),this.resumeReactivity(),y(o.loading,[Math.max(r,i),s])}unshiftCol(t=1){this.pauseReactivity();let l=o.max_cols,e=o.col_offset,i=e+this.cols,s=Math.max(0,e-t),r=Math.min(i,s+l),a=i-r;a>0&&super.popCols(a),o.col_offset=s;let _=w(Math.min(l,t),d,()=>({}));super.unshiftCols(..._),this.resumeReactivity(),y(o.loading,[s,Math.min(r,e)])}popCol(t=1){let l=o.col_offset,e=l+this.cols,i=Math.max(0,e-t),s=Math.min(l,i);o.col_offset=s,super.popCols(t)}shiftCol(t=1){let l=o.col_offset,e=Math.max(0,l+t);o.col_offset=e,super.shiftCols(t)}},d=8,$=3,c=new Y({rows:d,cols:$,originAlign:"right",colAlign:["end"],rowAlign:["center"],colGap:[30],rowGap:[30]},!0),C=[.1,.1,.25,1.5/4,.25,1.5/4,1.75/4,1.25/4],u,j=async(t,l)=>{let e=new Image,i=l%10;u[t][l]=e,e.onload=()=>{D(t,l,e)},e.src=o.image_dir+`${t},${i}.jpg`},y=async(t=0,l=void 0)=>{l??=[o.col_offset,o.col_offset+c.cols];let e=[],i=[],[s,r]=l;for(let a=s;a<r;a++)for(let _=0;_<d;_++)e.push([_,a]);T(e);for(let[a,_]of e)i.push(F(S()*t).then(()=>j(a,_)));Promise.all(i)},M=async(t=0)=>(u=w(d,o.max_images),y(t,void 0)),D=(t,l,e)=>{let{width:i,height:s}=e;c.setCell(t,Math.max(0,(l-o.col_offset)%c.cols),{width:i*C[t],height:s*C[t]})},n=document.createElement("canvas"),f=n.getContext("2d");n.width=2e3,n.height=800;var v=b(t=>{let l=c.getCellFrames(t);f.reset(),console.log("redraw");for(let e=0;e<c.cols;e++)for(let i=0;i<c.rows;i++){let{left:s,top:r,x:a,y:_,width:g,height:m}=l[i][e],h=u[i][e+o.col_offset];h&&f.drawImage(h,s+a,r+_,g,m)}});n.onmousedown=t=>{let{offsetX:l,offsetY:e,currentTarget:i}=t,s=c.hit(l,e);if(s){let{left:r,top:a,x:_,y:g,width:m,height:h}=c.getCellFrame(...s),x=r+_,p=a+g,k=l>=x&&l<=x+m,A=e>=p&&e<=p+h;if(k&&A){let R=f.strokeStyle;f.strokeStyle="red",f.strokeRect(x,p,m,h),f.strokeStyle=R}}},document.body.appendChild(n),M(o.loading).then(()=>{v()});var E,I=()=>{z(E),P(v,o.lazy_load_interval)};I();export{o as app_config,c as grid,M as loadAllImages,v as redraw,I as set_redraw_interval,X as signalCtx};
