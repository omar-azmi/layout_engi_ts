import{Array2DShape as f,SignalingClass as X,alignmentToNumber as b,boundboxOfRotatedRect as H,clamp as W,cumulativeSum as v,math_max as G,newArray2D as D,number_POSITIVE_INFINITY as y,parseAlignments as q,rotateArray2DMajor as E,rotateArray2DMinor as V,spliceArray2DMajor as k,spliceArray2DMinor as B}from"./chunk-RLUFV3VX.js";var J=class extends X{cols;rows;originAlign;colWidth;rowHeight;colMinWidth;rowMinHeight;colMaxWidth;rowMaxHeight;colAlign;rowAlign;colGap;rowGap;cells;getColWidths=this.comp(t=>{this.isDirty(t);let{cols:e,colWidth:o,colMinWidth:s,colMaxWidth:l}=this,i=o.length,h=s.length,n=l.length,a=Array(e).fill(0);for(let r=0;r<e;r++){let g=o[r%i],d=s[r%h],p=l[r%n];a[r]=G(...this.getCol(r).map(w=>{let{width:c,height:_=0,rotation:u}=w,m=c!==void 0?H(c,_,u).width:g;return W(m,d,p)}))}return a},{equals:!1});getRowHeights=this.comp(t=>{this.isDirty(t);let{rows:e,rowHeight:o,rowMinHeight:s,rowMaxHeight:l}=this,i=o.length,h=s.length,n=l.length,a=Array(e).fill(0);for(let r=0;r<e;r++){let g=o[r%i],d=s[r%h],p=l[r%n];a[r]=G(...this.getRow(r).map(w=>{let{width:c=0,height:_,rotation:u}=w,m=_!==void 0?H(c,_,u).height:g;return W(m,d,p)}))}return a},{equals:!1});get_left_positions=this.comp(t=>{let e=this.getColWidths(t),o=this.colGap,s=o.length,l=e.map((i,h)=>i+o[h%s]);return v(l)},{equals:!1});get_top_positions=this.comp(t=>{let e=this.getRowHeights(t),o=this.rowGap,s=o.length,l=e.map((i,h)=>i+o[h%s]);return v(l)},{equals:!1});get_topleft_aligned_cell_frames=this.comp(t=>{let e=this.getColWidths(t),o=this.getRowHeights(t),s=this.get_left_positions(t),l=this.get_top_positions(t),{rows:i,cols:h,cells:n,colAlign:a,rowAlign:r}=this,g=a.length,d=r.length,p=D(i,h);for(let w=0;w<i;w++)for(let c=0;c<h;c++){let _=s[c],u=l[w],m=e[c],A=o[w],$=_+m,I=u+A,{width:C=0,height:M=0,rotation:F,anchor:{x:S,y:j}={},colAlign:N=a[c%g],rowAlign:O=r[w%d]}=n[w][c],x=b(N),R=b(O),T=S??x,Y=j??R,z=m*x-C*T,P=A*R-M*Y;p[w][c]={left:_,top:u,right:$,bottom:I,x:z,y:P,width:C,height:M,rotation:F}}return p},{equals:!1});width=this.comp(t=>this.get_left_positions(t).at(-1),{equals:!1});height=this.comp(t=>this.get_top_positions(t).at(-1),{equals:!1});getCellFrames=this.comp(t=>{let e=this.get_topleft_aligned_cell_frames(t),o=this.width(t),s=this.height(t),{rows:l,cols:i,originAlign:h}=this,n=h.includes("right"),a=h.includes("bottom");if(n||a)for(let r=0;r<l;r++)for(let g=0;g<i;g++){let d=e[r][g],{top:p,left:w,bottom:c,right:_}=d;n&&(d.right=o-w,d.left=o-_),a&&(d.bottom=s-p,d.top=s-c)}return e},{equals:!1});constructor(t,e=!1){super(e);let{rows:o,cols:s,originAlign:l="",colWidth:i=[0],rowHeight:h=[0],colMinWidth:n=[0],rowMinHeight:a=[0],colMaxWidth:r=[y],rowMaxHeight:g=[y],colAlign:d=["start"],rowAlign:p=["start"],colGap:w=[0],rowGap:c=[0]}=t,_=D(o,s);for(let u=0;u<o;u++)for(let m=0;m<s;m++)_[u][m]={};Object.assign(this,{rows:o,cols:s,originAlign:l,colWidth:i,rowHeight:h,colGap:w,rowGap:c,colMinWidth:n,rowMinHeight:a,colMaxWidth:r,rowMaxHeight:g,cells:_,colAlign:q(d),rowAlign:q(p)}),this.getCellFrames()}getCellFrame(t,e){let{rows:o,cols:s,getCellFrames:l}=this;return l()[t%o][e%s]}getRow(t){return this.cells[t]}getCol(t){return this.cells.map(e=>e[t])}getCell(t,e){return this.cells[t][e]}setCell(t,e,o){this.cells[t][e]=o,this.setDirty()}spliceRows(t,e,...o){let{cells:s,setDirty:l}=this,i=k(s,t,e,...o),[h,n]=f(s);return this.rows=h,l(),i}spliceCols(t,e,...o){let{cells:s,setDirty:l}=this,i=B(s,t,e,...o),[h,n]=f(s);return this.cols=n,l(),i}rotateRows(t){let{cells:e,setDirty:o}=this;E(e,t),o()}rotateCols(t){let{cells:e,setDirty:o}=this;V(e,t),o()}pushRows(...t){let{rows:e,cols:o}=this,[s,l]=f(t),i=e+s;return l!==o?e:(this.spliceRows(e,0,...t),i)}pushCols(...t){let{rows:e,cols:o}=this,[s,l]=f(t),i=o+s;return l!==e?o:(this.spliceCols(o,0,...t),i)}unshiftRows(...t){let{rows:e,cols:o}=this,[s,l]=f(t),i=e+s;return l!==o?e:(this.spliceRows(0,0,...t),i)}unshiftCols(...t){let{rows:e,cols:o}=this,[s,l]=f(t),i=o+s;return l!==e?o:(this.spliceCols(0,0,...t),i)}popRows(t=1){return this.spliceRows(this.rows-t,t)}popCols(t=1){return this.spliceCols(this.cols-t,t)}shiftRows(t=1){return this.spliceRows(0,t)}shiftCols(t=1){return this.spliceCols(0,t)}static fromCells(t,e){let[o,s]=f(t),l=new this({rows:0,cols:s,...e});return l.pushRows(...t),l}hit(t,e){let o=this.originAlign,s=o.includes("right"),l=o.includes("bottom"),i=this.get_left_positions(),h=this.get_top_positions(),n=i.at(-1),a=h.at(-1);if(t=s?n-t:t,e=l?a-e:e,t<0||t>n||e<0||e>a)return;let r=t===0?0:i.findIndex(g=>t<=g)-1;return[e===0?0:h.findIndex(g=>e<=g)-1,r]}toPreview(t,e){}};export{J as Grid};
