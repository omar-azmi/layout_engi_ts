var $t=()=>{},Bt=t=>t.length===0,Ae=String.fromCharCode,{from:Me,isArray:Ie,of:Se}=Array,{isInteger:Ee,MAX_VALUE:pt,NEGATIVE_INFINITY:xe,POSITIVE_INFINITY:mt}=Number,{assign:Re,defineProperty:qe,entries:Fe,fromEntries:De,keys:He,getPrototypeOf:zt,values:We}=Object,Yt=Date.now,{iterator:Te,toStringTag:Ge}=Symbol,wt=(t,e=-pt,s=pt)=>t<e?e:t>s?s:t,ft=(t,e)=>(t%e+e)%e,T=(t,e)=>t<e?t:e,E=(t,e)=>t>e?t:e,R=t=>{let e=t.length,s=t[0]?.length??0;return[e,s]},bt=t=>{let[e,s]=R(t),r=[];for(let i=0;i<s;i++)r[i]=[];for(let i=0;i<e;i++)for(let l=0;l<s;l++)r[l][i]=t[i][l];return r},tt=(t,e,s,...r)=>{let[i,l]=R(t);return s??=E(i-e,0),t.splice(e,s,...r)},et=(t,e,s,...r)=>{let[i,l]=R(t),h=r.length>0?bt(r):Array(i).fill([]);return s??=E(l-e,0),bt(t.map((g,d)=>g.splice(e,s,...h[d])))},Xt=(t,e)=>{let[s,r]=R(t);if(e=ft(e,s===0?1:s),e===0)return t;let i=tt(t,s-e,e);return tt(t,0,0,...i),t},Jt=(t,e)=>{let[s,r]=R(t);if(e=ft(e,r===0?1:r),e===0)return t;let i=et(t,r-e,e);return et(t,0,0,...i),t},yt=t=>zt(t).constructor,O=(t,...e)=>new(yt(t))(...e),st=t=>t.prototype,D=(t,e,...s)=>r=>t[e].bind(r,...s),vt=(t,e,...s)=>t[e].bind(t,...s),rt=st(Array),V=st(Map),$=st(Set),Kt=D(rt,"pop"),Ct=D(rt,"push"),Qt=D(rt,"splice",0),it=D($,"add"),At=D($,"clear"),Mt=D($,"delete"),It=D($,"has"),St=D(V,"clear"),lt=D(V,"delete"),P=D(V,"get"),G=D(V,"set"),Et=Symbol("a rejection by a throttled function"),Zt=(t,e)=>{let s=0;return(...r)=>{let i=Yt();return i-s>t?(s=i,e(...r)):Et}},xt=t=>{let e=t.length,s=new(yt(t))(e+1).fill(0);for(let r=0;r<e;r++)s[r+1]=s[r]+t[r];return s},te=(t,e)=>t===e,ee=(t,e)=>!1,Rt=t=>t===!1?ee:t??te,se=(t,e)=>{let s=Rt(e),r=Zt(t,s);return(i,l)=>{let h=r(i,l);return h===Et?!0:h}},re=t=>{let e=t.length**.5;return t.reduce((s,r)=>s+r*(r+e),0)},Ne=$t,B=t=>{let{newId:e,getId:s,setId:r,addEdge:i}=t;return class{constructor(l,{name:h,equals:g}={}){let d=e();r(d,this),this.id=d,this.rid=d,this.name=h,this.value=l,this.equals=Rt(g)}get(l){return l&&i(this.id,l),this.value}set(l){let h=this.value;return!this.equals(h,this.value=typeof l=="function"?l(h):l)}run(l){return l?1:0}bindMethod(l){return vt(this,l)}static create(...l){let h=new this(...l);return[h.id,h]}}},ie=t=>{let e=t.runId;return class extends t.getClass(B){constructor(s,r){super(s,r)}set(s){return super.set(s)?(e(this.id),!0):!1}static create(s,r){let i=new this(s,r);return[i.id,i.bindMethod("get"),i.bindMethod("set")]}}},le=t=>class extends t.getClass(B){constructor(e,s){super(s?.value,s),this.fn=e,s?.defer===!1&&this.get()}get(e){return this.rid&&(this.run(),this.rid=0),super.get(e)}run(e){return super.set(this.fn(this.rid))?1:0}static create(e,s){let r=new this(e,s);return[r.id,r.bindMethod("get")]}},oe=t=>class extends t.getClass(B){constructor(e,s){super(s?.value,s),this.fn=e,this.dirty=1,s?.defer===!1&&this.get()}run(e){return this.dirty=1}get(e){return(this.rid||this.dirty)&&(super.set(this.fn(this.rid)),this.dirty=0,this.rid=0),super.get(e)}static create(e,s){let r=new this(e,s);return[r.id,r.bindMethod("get")]}},he=t=>{let e=t.runId;return class extends t.getClass(B){constructor(s,r){super(void 0,r),this.fn=s,r?.defer===!1&&this.set()}get(s){s&&(this.rid&&this.run(),super.get(s))}set(){return e(this.id)}run(s){let r=this.fn(this.rid)!==!1;return this.rid&&(this.rid=0),r?1:0}static create(s,r){let i=new this(s,r);return[i.id,i.bindMethod("get"),i.bindMethod("set")]}}},ae=class{addEdge;delEdge;newId;getId;setId;delId;runId;swapId;clearCache;addClass;getClass;batch;dynamic;constructor(){let t=0,e=0,s=new Map,r=new Map,i=P(s),l=P(r),h=G(s),g=G(r),d=lt(s),a=lt(r),u=new Map,p=P(u),y=G(u),c=St(u),o=n=>{let _=new Set,b=it(_),v=It(_),F=W=>{v(W)||(i(W)?.forEach(F),b(W))};return n.forEach(F),n.forEach(Mt(_)),[..._,...n].reverse()},w=(...n)=>{let _=re(n);return p(_)??(y(_,o(n))&&p(_))},f=new Map,m=P(f),C=G(f),M=lt(f),A=new Set,S=it(A),x=Mt(A),q=At(A),j=new Set,Y=it(j),X=It(j),J=At(j),L=new Map,K=G(L),nt=St(L),U=[],Q=Ct(U),Z=Kt(U),ct=(...n)=>{q(),J(),n.forEach(S);let _=n.length,b=w(...n);for(let F of b){if(x(F)&&!X(F)){let W=Lt(F,_-- >0);W!==0&&i(F)?.forEach(W>=1?S:Y)}if(A.size<=0)break}let v;for(;v=Z();)m(v)?.postrun()},Lt=(n,_)=>{let b=_===!0,v=m(n),F=v?.run(b)??0;return F>=1&&v.postrun&&Q(n),F},_t=[],Ot=Ct(_t),Pt=Qt(_t),gt=()=>++e,dt=()=>{--e<=0&&(e=0,ct(...Pt()))},kt=(n,..._)=>{gt();let b=n(..._);return dt(),b};this.addEdge=(n,_)=>{if(n+_<=0)return!1;let b=i(n)??(h(n,new Set)&&i(n));return b.has(_)?!1:(b.add(_),l(_)?.add(n)||g(_,new Set([n])),c(),!0)},this.delEdge=(n,_)=>i(n)?.delete(_)&&l(_)?.delete(n)?(c(),!0):!1,this.newId=()=>(c(),++t),this.getId=m,this.setId=C,this.delId=n=>{if(M(n)){let _=i(n),b=l(n);return _?.forEach(v=>{l(v)?.delete(n)}),b?.forEach(v=>{i(v)?.delete(n)}),_?.clear(),b?.clear(),d(n),a(n),c(),!0}return!1},this.swapId=(n,_)=>{let b=m(n),v=m(_);C(n,v),C(_,b),b&&(b.id=_,b.rid&&(b.rid=_)),v&&(v.id=n,v.rid&&(v.rid=n)),c()},this.clearCache=c,this.runId=n=>e<=0?(ct(n),!0):(Ot(n),!1);let ut=new Map,Ut=P(ut),Vt=G(ut);this.addClass=n=>{let _=this.getClass(n);return vt(_,"create")},this.getClass=n=>{let _=Ut(n);return _||(_=n(this),Vt(n,_),_)},this.batch={startBatching:gt,endBatching:dt,scopedBatching:kt},this.dynamic={setValue:(n,_)=>{let b=m(n??0);b&&(b.value=_)},setEquals:(n,_)=>{let b=m(n??0);b&&(b.equals=_)},setFn:(n,_)=>{let b=m(n??0);b&&(b.fn=_)}}}},ne=Number.isFinite,{abs:qt,cos:ce,max:Ft,sin:_e,random:ge}=Math,de=t=>{let e=t.length,s=()=>ge()*e|0,r=(i,l)=>{let h=t[i];t[i]=t[l],t[l]=h};for(let i=0;i<e;i++)r(i,s());return t},Dt=(t,e,s)=>{let r=typeof s=="function"?()=>Array(e).fill(void 0).map(s):()=>Array(e).fill(s);return Array(t).fill(void 0).map(r)},ue=function*(t){let e=t.length;for(;!Bt(t);)e>=t.length&&(e=0,de(t)),e=E(e+((yield t[e])??1),0)},z=(t,e=!1)=>(typeof t=="string"&&(t=t==="start"?0:t==="end"?1:.5),e?1-t:t),ot=(t,e=!1)=>(t=Array.isArray(t)?t:[t],t.map(s=>z(s,e))),ht=(t,e,s)=>{if(!s)return{width:t,height:e};let r=qt(ce(s)),i=qt(_e(s));return{width:t*r+e*i,height:t*i+e*r}},pe=t=>{let e={px:0,pw:0,ph:0};for(let s of t.split("+")){let r=s.trim(),i=+r.slice(0,-2),l=r.slice(-2);e[l]+=i}return e},N=t=>{if(typeof t=="object")return t;let e=Number(t);return ne(e)?{px:e}:pe(t)},me=["px","pw","ph"],we=t=>{let e=N(t);return me.map(s=>String(e[s]??0)+s).join(" + ")},k=new ae,Ht=k.addClass(ie),Wt=k.addClass(le),Tt=k.addClass(oe),fe=k.addClass(he),at=(...t)=>Ht(...t).splice(1),I=(...t)=>Wt(...t)[1],Gt=(...t)=>Tt(...t)[1],H=t=>typeof t=="function"?[t,void 0]:at(t),Nt=class{comp;isDirty;setDirty;paused=!1;pauseReactivity(){this.paused=!0}resumeReactivity(){this.paused=!1}constructor(t){let[e,s]=at(void 0,{equals:()=>this.paused});this.comp=t?Gt:I,this.isDirty=e,this.setDirty=s}},be=class extends Nt{cols;rows;originAlign;colWidth;rowHeight;colMinWidth;rowMinHeight;colMaxWidth;rowMaxHeight;colAlign;rowAlign;colGap;rowGap;cells;getColWidths=this.comp(t=>{this.isDirty(t);let{cols:e,colWidth:s,colMinWidth:r,colMaxWidth:i}=this,l=s.length,h=r.length,g=i.length,d=Array(e).fill(0);for(let a=0;a<e;a++){let u=s[a%l],p=r[a%h],y=i[a%g];d[a]=Ft(...this.getCol(a).map(c=>{let{width:o,height:w=0,rotation:f}=c,m=o!==void 0?ht(o,w,f).width:u;return wt(m,p,y)}))}return d},{equals:!1});getRowHeights=this.comp(t=>{this.isDirty(t);let{rows:e,rowHeight:s,rowMinHeight:r,rowMaxHeight:i}=this,l=s.length,h=r.length,g=i.length,d=Array(e).fill(0);for(let a=0;a<e;a++){let u=s[a%l],p=r[a%h],y=i[a%g];d[a]=Ft(...this.getRow(a).map(c=>{let{width:o=0,height:w,rotation:f}=c,m=w!==void 0?ht(o,w,f).height:u;return wt(m,p,y)}))}return d},{equals:!1});get_left_positions=this.comp(t=>{let e=this.getColWidths(t),s=this.colGap,r=s.length,i=e.map((l,h)=>l+s[h%r]);return xt(i)},{equals:!1});get_top_positions=this.comp(t=>{let e=this.getRowHeights(t),s=this.rowGap,r=s.length,i=e.map((l,h)=>l+s[h%r]);return xt(i)},{equals:!1});get_topleft_aligned_cell_frames=this.comp(t=>{let e=this.getColWidths(t),s=this.getRowHeights(t),r=this.get_left_positions(t),i=this.get_top_positions(t),{rows:l,cols:h,cells:g,colAlign:d,rowAlign:a}=this,u=d.length,p=a.length,y=Dt(l,h);for(let c=0;c<l;c++)for(let o=0;o<h;o++){let w=r[o],f=i[c],m=e[o],C=s[c],M=w+m,A=f+C,{width:S=0,height:x=0,rotation:q,anchor:{x:j,y:Y}={},colAlign:X=d[o%u],rowAlign:J=a[c%p]}=g[c][o],L=z(X),K=z(J),nt=j??L,U=Y??K,Q=m*L-S*nt,Z=C*K-x*U;y[c][o]={left:w,top:f,right:M,bottom:A,x:Q,y:Z,width:S,height:x,rotation:q}}return y},{equals:!1});width=this.comp(t=>this.get_left_positions(t).at(-1),{equals:!1});height=this.comp(t=>this.get_top_positions(t).at(-1),{equals:!1});getCellFrames=this.comp(t=>{let e=this.get_topleft_aligned_cell_frames(t),s=this.width(t),r=this.height(t),{rows:i,cols:l,originAlign:h}=this,g=h.includes("right"),d=h.includes("bottom");if(g||d)for(let a=0;a<i;a++)for(let u=0;u<l;u++){let p=e[a][u],{top:y,left:c,bottom:o,right:w}=p;g&&(p.right=s-c,p.left=s-w),d&&(p.bottom=r-y,p.top=r-o)}return e},{equals:!1});constructor(t,e=!1){super(e);let{rows:s,cols:r,originAlign:i="",colWidth:l=[0],rowHeight:h=[0],colMinWidth:g=[0],rowMinHeight:d=[0],colMaxWidth:a=[mt],rowMaxHeight:u=[mt],colAlign:p=["start"],rowAlign:y=["start"],colGap:c=[0],rowGap:o=[0]}=t,w=Dt(s,r);for(let f=0;f<s;f++)for(let m=0;m<r;m++)w[f][m]={};Object.assign(this,{rows:s,cols:r,originAlign:i,colWidth:l,rowHeight:h,colGap:c,rowGap:o,colMinWidth:g,rowMinHeight:d,colMaxWidth:a,rowMaxHeight:u,cells:w,colAlign:ot(p),rowAlign:ot(y)}),this.getCellFrames()}getCellFrame(t,e){let{rows:s,cols:r,getCellFrames:i}=this;return i()[t%s][e%r]}getRow(t){return this.cells[t]}getCol(t){return this.cells.map(e=>e[t])}getCell(t,e){return this.cells[t][e]}setCell(t,e,s){this.cells[t][e]=s,this.setDirty()}spliceRows(t,e,...s){let{cells:r,setDirty:i}=this,l=tt(r,t,e,...s),[h,g]=R(r);return this.rows=h,i(),l}spliceCols(t,e,...s){let{cells:r,setDirty:i}=this,l=et(r,t,e,...s),[h,g]=R(r);return this.cols=g,i(),l}rotateRows(t){let{cells:e,setDirty:s}=this;Xt(e,t),s()}rotateCols(t){let{cells:e,setDirty:s}=this;Jt(e,t),s()}pushRows(...t){let{rows:e,cols:s}=this,[r,i]=R(t),l=e+r;return i!==s?e:(this.spliceRows(e,0,...t),l)}pushCols(...t){let{rows:e,cols:s}=this,[r,i]=R(t),l=s+r;return i!==e?s:(this.spliceCols(s,0,...t),l)}unshiftRows(...t){let{rows:e,cols:s}=this,[r,i]=R(t),l=e+r;return i!==s?e:(this.spliceRows(0,0,...t),l)}unshiftCols(...t){let{rows:e,cols:s}=this,[r,i]=R(t),l=s+r;return i!==e?s:(this.spliceCols(0,0,...t),l)}popRows(t=1){return this.spliceRows(this.rows-t,t)}popCols(t=1){return this.spliceCols(this.cols-t,t)}shiftRows(t=1){return this.spliceRows(0,t)}shiftCols(t=1){return this.spliceCols(0,t)}static fromCells(t,e){let[s,r]=R(t),i=new this({rows:0,cols:r,...e});return i.pushRows(...t),i}hit(t,e){let s=this.originAlign,r=s.includes("right"),i=s.includes("bottom"),l=this.get_left_positions(),h=this.get_top_positions(),g=l.at(-1),d=h.at(-1);if(t=r?g-t:t,e=i?d-e:e,t<0||t>g||e<0||e>d)return;let a=t===0?0:l.findIndex(u=>t<=u)-1;return[e===0?0:h.findIndex(u=>e<=u)-1,a]}toPreview(t,e){}},ye=["left","top","right","bottom"],ve=["aqua","aquamarine","antiquewhite","blue","brown","blueviolet","chartreuse","crimson","darkkhaki","darkorange","darksalmon","fuchsia","gold","green","orangered","yellow","yellowgreen"],jt=ue(ve),Ce=class{children=[];constructor(t,e,s,r){let i=[t,e,s,r],l={};for(let h=0;h<4;h++){let g=ye[h],d=i[h],[a,u]=H(d);this[g]=a,l[g]=u}this.set=l}getFreespaceChild(){let{children:t}=this;if(t.length>0)return t[0];let{left:e,top:s,right:r,bottom:i}=this,l=O(this,e,s,r,i);return t.push(l),l}splitChildLeft(t,e={}){e.left??=0,e.right??=0;let s=this.getFreespaceChild(),{left:r,top:i,right:l,bottom:h}=s,[g,d]=H(N(t)),[a,u]=H({...e,top:0,bottom:0}),p=I(o=>{let{left:w=0,right:f=0}=a(o);return T(r(o)+w,l(o)-f)}),y=I(o=>{let{left:w=0,right:f=0}=a(o),m=r(o)+w,C=E(l(o)-f,m),M=i(o),A=h(o),{px:S=0,pw:x=0,ph:q=0}=g(o);return T(m+S+(C-m)*x+(A-M)*q,C)}),c=O(this,p,i,y,h);return c.margin=a,c.width=g,c.set.margin=u,c.set.width=d,s.left=I(o=>T(y(o)+a(o).right,l(o))),this.children.push(c),c}splitChildTop(t,e={}){e.top??=0,e.bottom??=0;let s=this.getFreespaceChild(),{left:r,top:i,right:l,bottom:h}=s,[g,d]=H(N(t)),[a,u]=H({...e,left:0,right:0}),p=I(o=>{let{top:w=0,bottom:f=0}=a(o);return T(i(o)+w,h(o)-f)}),y=I(o=>{let{top:w=0,bottom:f=0}=a(),m=r(o),C=l(o),M=i(o)+w,A=E(h(o)-f,M),{px:S=0,pw:x=0,ph:q=0}=g(o);return T(M+S+(C-m)*x+(A-M)*q,A)}),c=O(this,r,p,l,y);return c.margin=a,c.height=g,c.set.margin=u,c.set.height=d,s.top=I(o=>T(y(o)+a(o).bottom,h(o))),this.children.push(c),c}splitChildRight(t,e={}){e.left??=0,e.right??=0;let s=this.getFreespaceChild(),{left:r,top:i,right:l,bottom:h}=s,[g,d]=H(N(t)),[a,u]=H({...e,top:0,bottom:0}),p=I(o=>{let{left:w=0,right:f=0}=a(o),m=r(o)+w,C=E(l(o)-f,m),M=i(o),A=h(o),{px:S=0,pw:x=0,ph:q=0}=g(o);return E(C-S-(C-m)*x-(A-M)*q,m)}),y=I(o=>{let{left:w=0,right:f=0}=a(o);return E(r(o)+w,l(o)-f)}),c=O(this,p,i,y,h);return c.margin=a,c.width=g,c.set.margin=u,c.set.width=d,s.right=I(o=>E(p(o)+a(o).left,r(o))),this.children.push(c),c}splitChildBottom(t,e={}){e.top??=0,e.bottom??=0;let s=this.getFreespaceChild(),{left:r,top:i,right:l,bottom:h}=s,[g,d]=H(N(t)),[a,u]=H({...e,left:0,right:0}),p=I(o=>{let{top:w=0,bottom:f=0}=a(o),m=r(o),C=l(o),M=i(o)+w,A=E(h(o)-f,M),{px:S=0,pw:x=0,ph:q=0}=g(o);return E(A-S-(C-m)*x-(A-M)*q,M)}),y=I(o=>{let{top:w=0,bottom:f=0}=a(o);return E(i(o)+w,h(o)-f)}),c=O(this,r,p,l,y);return c.margin=a,c.height=g,c.set.margin=u,c.set.height=d,s.bottom=I(o=>E(p(o)+a(o).top,i(o))),this.children.push(c),c}hit(t,e){if(this.left()<=t&&t<=this.right()&&this.top()<=e&&e<=this.bottom()){let s=this.children,r=s.length,i,l=0;for(;++l<r&&!(i=s[l].hit(t,e)););return i??this}}toString(){let{left:t,top:e,right:s,bottom:r,margin:i,width:l,height:h,set:g,children:d}=this,a=[],u={setters:a,position:[t(),e(),s(),r()]};for(let p in g)g[p]!==void 0&&a.push(p);if(i){let{left:p,top:y,right:c,bottom:o}=i();u.margin=[p,y,c,o]}return l&&(u.width=l()),h&&(u.height=h()),d.length>0&&(u.children=d.map(p=>p.toString())),u}toPreview(t,e){let s=this.children,r=s.length;if(r<=1||e){let{left:i,top:l,right:h,bottom:g}=this,d=i(),a=l(),u=h()-d,p=g()-a;t.fillStyle=e??jt.next().value,t.fillRect(d,a,u,p)}for(let i=0;i<r;i++)s[i].toPreview(t,i===0?e??"gray":void 0)}};export{Ce as FrameSplit,be as Grid,Nt as SignalingClass,z as alignmentToNumber,ht as boundboxOfRotatedRect,fe as createEffectSignal,Gt as createLazy,Tt as createLazySignal,I as createMemo,Wt as createMemoSignal,at as createState,H as createStateIfPrimitive,Ht as createStateSignal,ot as parseAlignments,N as parseLengthUnit,jt as pick_color_iter,k as signalCtx,we as stringifyLengthUnit,se as throttlingEquals};
